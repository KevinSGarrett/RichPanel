Use a “Processed” Flag: 

A very reliable pattern is to use a tag or custom field as a loop-prevention flag. For instance, have your automation rule check that a certain tag (say “bot_processed”) is not present on the ticket before firing. Then, as part of your middleware’s response, add that “bot_processed” tag (or set a field) on the ticket. This way, if the same ticket sees another customer message or somehow re-enters the rule, the presence of the tag will cause the rule condition to fail and it won’t fire again. You can implement this easily: in your automation rule conditions, add “Tags does not contain ‘bot_processed’”. And in your middleware, when you send the reply via API, also include an update to add the ‘bot_processed’ tag (or perhaps set a custom field “Last response by bot = true”). This ensures one-time execution per ticket. If you need it per message, you could have the middleware remove the tag when a new customer reply comes in (that might be overkill; usually one automated attempt per conversation is enough, then hand off to humans).