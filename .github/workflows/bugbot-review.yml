name: Bugbot Review Trigger

on:
  workflow_dispatch:
    inputs:
      pr_number:
        description: "Pull Request number to comment on"
        required: true
        type: string
      comment_body:
        description: "Comment body to post on the PR"
        required: false
        default: "@cursor review"
        type: string

permissions:
  issues: write

jobs:
  post_comment:
    name: Post Bugbot trigger comment
    runs-on: ubuntu-latest
    steps:
      - name: Create PR comment
        uses: actions/github-script@v7
        with:
          github-token: ${{ github.token }}
          script: |
            const prNumberRaw = String(context.payload.inputs?.pr_number ?? "").trim();
            const commentBody = String(context.payload.inputs?.comment_body ?? "@cursor review");

            const prNumber = Number(prNumberRaw);
            if (!Number.isInteger(prNumber) || prNumber <= 0) {
              core.setFailed(`Invalid pr_number: "${prNumberRaw}". Expected a positive integer as a string.`);
              return;
            }

            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: prNumber,
              body: commentBody,
            });


