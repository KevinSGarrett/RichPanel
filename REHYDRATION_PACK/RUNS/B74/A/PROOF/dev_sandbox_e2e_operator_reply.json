{
  "meta": {
    "run_id": "B74_A_20260209_0028Z",
    "timestamp": "2026-02-09T00:31:53.231802+00:00",
    "env": "dev",
    "region": "us-east-2",
    "scenario": "order_status",
    "scenario_variant": "order_status_tracking"
  },
  "inputs": {
    "ticket_ref": null,
    "ticket_ref_fingerprint": "ccc6742d528e",
    "apply_test_tag": false,
    "test_tag_value": null,
    "command": "python scripts/dev_e2e_smoke.py --env dev --region us-east-2 --profile rp-admin-dev-admin --stack-name RichpanelMiddleware-dev --scenario order_status --ticket-number <redacted> --require-outbound --require-operator-reply --followup --run-id B74_A_20260209_0028Z --proof-path REHYDRATION_PACK/RUNS/B74/A/PROOF/dev_sandbox_e2e_operator_reply.json"
  },
  "webhook": {
    "endpoint": "https://pj41mkbj38.execute-api.us-east-2.amazonaws.com/webhook",
    "queue_url": "https://sqs.us-east-2.amazonaws.com/151124909266/rp-mw-dev-events.fifo",
    "event_id_fingerprint": "e52b49cdb88f",
    "conversation_id": null,
    "conversation_id_fingerprint": "0475d67c36e9",
    "accepted": true
  },
  "dynamo": {
    "idempotency_table": "rp_mw_dev_idempotency",
    "conversation_state_table": "rp_mw_dev_conversation_state",
    "audit_trail_table": "rp_mw_dev_audit_trail",
    "links": {
      "idempotency": "https://us-east-2.console.aws.amazon.com/dynamodbv2/home?region=us-east-2#item-explorer?initialTagKey=&initialTagValue=&table=rp_mw_dev_idempotency",
      "conversation_state": "https://us-east-2.console.aws.amazon.com/dynamodbv2/home?region=us-east-2#item-explorer?initialTagKey=&initialTagValue=&table=rp_mw_dev_conversation_state",
      "audit": "https://us-east-2.console.aws.amazon.com/dynamodbv2/home?region=us-east-2#item-explorer?initialTagKey=&initialTagValue=&table=rp_mw_dev_audit_trail",
      "logs": "https://us-east-2.console.aws.amazon.com/cloudwatch/home?region=us-east-2#logsV2:log-groups/log-group/$252Faws$252Flambda$252Frp-mw-dev-worker"
    },
    "idempotency_record": {
      "status": "processed",
      "mode": "automation_candidate",
      "safe_mode": false,
      "automation_enabled": true,
      "payload_field_count": 34
    },
    "state_record": {
      "routing": {
        "category": "order_status",
        "tags": [
          "mw-routing-applied",
          "mw-intent-order_status_tracking",
          "mw-llm-routed"
        ],
        "reason": "llm_routing (confidence=0.93)",
        "intent": "order_status_tracking",
        "department": "Email Support Team"
      },
      "action_count": 2,
      "updated_at": "2026-02-09T00:31:31.586225+00:00"
    },
    "audit_record": {
      "routing": {
        "category": "order_status",
        "tags": [
          "mw-routing-applied",
          "mw-intent-order_status_tracking",
          "mw-llm-routed"
        ],
        "reason": "llm_routing (confidence=0.93)",
        "intent": "order_status_tracking",
        "department": "Email Support Team"
      },
      "recorded_at": "2026-02-09T00:31:31.586225+00:00",
      "ts_action_fingerprint": "2026-02-09T00:31:31.586225+00:00#fingerprint:e52b49cdb88f"
    }
  },
  "openai": {
    "routing": {
      "llm_called": true,
      "model": "gpt-5.2-chat-latest",
      "confidence": 0.93,
      "response_id": "chatcmpl-D79TWUevsDdFB9ssp87d0IIvo2nW9",
      "response_id_unavailable_reason": null,
      "final_intent": "order_status_tracking",
      "primary_source": "llm",
      "final_source": "openai",
      "gated_reason": null
    },
    "rewrite": {
      "rewrite_attempted": true,
      "rewrite_applied": false,
      "model": "gpt-5.2-chat-latest",
      "response_id": "chatcmpl-D79TYSgkuPRF1ynsibBMB70Oudnoy",
      "response_id_unavailable_reason": null,
      "fallback_used": true,
      "reason": "risk_flagged",
      "error_class": "OpenAIRiskFlagged",
      "original_hash": "5dbbafcec73c",
      "rewritten_hash": "5dbbafcec73c",
      "rewritten_changed": false
    },
    "order_status_intent": {
      "llm_called": false,
      "model": null,
      "response_id": null,
      "response_id_unavailable_reason": "order_status_intent_missing",
      "confidence": null,
      "is_order_status": null,
      "language": null,
      "extracted_order_number_redacted": null,
      "accepted": null,
      "confidence_threshold": null,
      "gated_reason": null,
      "parse_error": null,
      "ticket_excerpt_redacted": null,
      "ticket_excerpt_fingerprint": null
    }
  },
  "allowlist": {},
  "routing_metadata": {
    "final": {
      "source": "openai",
      "intent": "order_status_tracking"
    },
    "openai": {
      "called": true,
      "model": "gpt-5.2-chat-latest",
      "request_id": "chatcmpl-D79TWUevsDdFB9ssp87d0IIvo2nW9",
      "response_id_unavailable_reason": null,
      "confidence": 0.93
    }
  },
  "rewriter_metadata": {
    "used": false,
    "model": "gpt-5.2-chat-latest",
    "request_id": "chatcmpl-D79TYSgkuPRF1ynsibBMB70Oudnoy",
    "original_hash": "5dbbafcec73c",
    "rewritten_hash": "5dbbafcec73c",
    "changed": false
  },
  "order_status": {
    "expected_delivery_estimate": {
      "eta_human": "1-3 business days",
      "normalized_method": "Standard (3-5 business days)",
      "elapsed_business_days": 2,
      "remaining_min_days": 1,
      "remaining_max_days": 3
    },
    "eta_window_verified": null,
    "eta_method_verified": null,
    "eta_window_fallback_used": false,
    "tracking_reply_verified": null,
    "tracking_reply_source": null,
    "tracking_number_present": null,
    "tracking_url_present": null,
    "tracking_number_fingerprint": null,
    "tracking_url_fingerprint": null
  },
  "richpanel": {
    "pre": {
      "status": "OPEN",
      "state": null,
      "tags": [
        "mw-intent-order_status_tracking",
        "mw-order-lookup-failed",
        "mw-order-lookup-missing:created_at",
        "mw-order-status-suppressed",
        "mw-routing-applied",
        "route-email-support-team"
      ],
      "updated_at": "2026-02-09T00:30:40.693Z",
      "message_count": 1,
      "last_message_source": "unknown",
      "operator_reply_present": false,
      "operator_reply_count": 0,
      "latest_comment_is_operator": false,
      "latest_comment_source": null,
      "ticket_channel": "email",
      "status_code": 200,
      "dry_run": false,
      "ticket_id_fingerprint": "0475d67c36e9",
      "endpoint_variant": "number",
      "path_redacted": "/v1/tickets/number/<redacted>",
      "customer_email_fingerprint": "25edb07c2a9e",
      "customer_name_fingerprint": "43961e111189",
      "latest_comment_author_id_fingerprint": "b186b7677d8b"
    },
    "post": {
      "status": "CLOSED",
      "state": null,
      "tags": [
        "mw-intent-order_status_tracking",
        "mw-order-lookup-failed",
        "mw-order-lookup-missing:created_at",
        "mw-order-status-suppressed",
        "mw-routing-applied",
        "route-email-support-team",
        "mw-llm-routed",
        "mw-auto-replied",
        "mw-order-status-answered",
        "mw-order-status-answered:B74_A_20260209_0028Z",
        "mw-outbound-path-send-message",
        "mw-reply-sent"
      ],
      "updated_at": "2026-02-09T00:31:40.556Z",
      "message_count": 2,
      "last_message_source": "operator",
      "operator_reply_present": true,
      "operator_reply_count": 1,
      "latest_comment_is_operator": true,
      "latest_comment_source": null,
      "ticket_channel": "email",
      "status_code": 200,
      "dry_run": false,
      "ticket_id_fingerprint": "0475d67c36e9",
      "endpoint_variant": "id",
      "path_redacted": "/v1/tickets/<redacted>",
      "customer_email_fingerprint": "25edb07c2a9e",
      "customer_name_fingerprint": "43961e111189",
      "latest_comment_author_id_fingerprint": "847bae851598"
    },
    "tags_added": [
      "mw-auto-replied",
      "mw-llm-routed",
      "mw-order-status-answered",
      "mw-order-status-answered:B74_A_20260209_0028Z",
      "mw-outbound-path-send-message",
      "mw-reply-sent"
    ],
    "tags_removed": [],
    "skip_tags_added": [],
    "updated_at_delta_seconds": 59.863,
    "status_before": "open",
    "status_after": "closed",
    "status_changed": true,
    "message_count_before": 1,
    "message_count_after": 2,
    "message_count_delta": 1,
    "last_message_source_before": "unknown",
    "last_message_source_after": "operator",
    "middleware_tags_added": [
      "mw-auto-replied",
      "mw-llm-routed",
      "mw-order-status-answered",
      "mw-order-status-answered:B74_A_20260209_0028Z",
      "mw-outbound-path-send-message",
      "mw-reply-sent"
    ],
    "test_tag_verified": null,
    "tag_result": null,
    "tag_error": null,
    "diagnostics": null,
    "auto_close_applied": false,
    "auto_close_result": null,
    "reply_update_success": true,
    "reply_update_candidate": "mw-auto-replied",
    "reply_fallback": null,
    "success_tag_added_this_run": true,
    "skip_or_escalation_tags_added_this_run": false,
    "operator_reply_present": true,
    "operator_reply_count_before": 0,
    "operator_reply_count_after": 1,
    "operator_reply_count_delta": 1,
    "latest_comment_is_operator": true,
    "send_message_tag_present": true,
    "send_message_tag_added": true
  },
  "followup": {
    "performed": true,
    "event_id_fingerprint": "029548a36e7b",
    "idempotency_record": {
      "status": "processed",
      "mode": "automation_candidate"
    },
    "tags_added": [
      "mw-intent-unknown_other",
      "mw-skip-followup-after-auto-reply"
    ],
    "tags_removed": [],
    "skip_tags_added": [
      "mw-skip-followup-after-auto-reply"
    ],
    "middleware_tags_added": [
      "mw-intent-unknown_other",
      "mw-skip-followup-after-auto-reply"
    ],
    "status_after": "closed",
    "message_count_delta": 0,
    "updated_at_delta_seconds": 10.333,
    "reply_sent": false,
    "reply_reason": "message_count_delta=0",
    "routed_to_support": true
  },
  "proof_fields": {
    "ticket_channel": "email",
    "channel_detected": "email",
    "channel_detection_source": "fetched_ticket",
    "bot_agent_id_source": "secrets_manager",
    "read_only_guard_active": false,
    "openai_routing_used": true,
    "openai_rewrite_used": true,
    "openai_routing_response_id": "chatcmpl-D79TWUevsDdFB9ssp87d0IIvo2nW9",
    "openai_rewrite_response_id": "chatcmpl-D79TYSgkuPRF1ynsibBMB70Oudnoy",
    "final_route": "route_to_support",
    "closed_after": true,
    "message_count_delta": 1,
    "last_message_source_after": "operator",
    "intent_after": "order_status_tracking",
    "routing_department": "Email Support Team",
    "outbound_attempted": true,
    "outbound_failure_classification": null,
    "outbound_send_message_status": 200,
    "outbound_endpoint_used": "/send-message",
    "routed_to_support": true,
    "support_tag_present": true,
    "support_department": true,
    "order_match_success": true,
    "order_match_failure_reason": null,
    "order_match_method": "none",
    "order_match_method_raw": "none",
    "order_match_method_source": "ticket_probe_resolution",
    "order_match_by_number": null,
    "reply_contains_tracking_url": true,
    "reply_contains_tracking_number_like": true,
    "reply_contains_eta_date_like": false,
    "latest_comment_source": null,
    "is_operator_reply": true,
    "routing_ticket_excerpt_redacted": "Where is my order? Please share the tracking update.",
    "allowlist_blocked_tag_present": false,
    "allowlist_blocked_tag_added": false,
    "send_message_tag_absent": false,
    "followup_routed_support": true,
    "followup_reply_sent": false,
    "followup_skip_tags_added": [
      "mw-skip-followup-after-auto-reply"
    ],
    "operator_reply_present": true,
    "operator_reply_count_delta": 1,
    "latest_comment_is_operator": true,
    "operator_reply_required": true,
    "operator_reply_confirmed": true,
    "operator_reply_reason": "confirmed",
    "send_message_tag_present": true,
    "send_message_tag_added": true,
    "send_message_path_required": false,
    "send_message_path_confirmed": true,
    "send_message_used": true,
    "send_message_endpoint_used": true,
    "send_message_status_code": 200,
    "send_message_author_id_redacted": "redacted:847bae851598",
    "bot_agent_id_redacted": "redacted:847bae851598",
    "send_message_author_matches_bot_agent": true
  },
  "result": {
    "status": "PASS",
    "classification": "PASS_STRONG",
    "classification_reason": null,
    "reply_evidence": true,
    "reply_evidence_reason": "message_count_delta=1; positive_middleware_tag_added; reply_update_success:mw-auto-replied",
    "outbound_failure_classification": null,
    "fallback_close_used": false,
    "followup_reply_sent": false,
    "followup_reply_reason": "message_count_delta=0",
    "criteria": {
      "scenario": "order_status",
      "webhook_accepted": true,
      "dynamo_records": true,
      "ticket_lookup": true,
      "intent_order_status": true,
      "intent_not_order_status": false,
      "middleware_outcome": true,
      "status_resolved_or_closed": true,
      "middleware_tag_applied": true,
      "no_skip_tags": true,
      "test_tag_verified": null,
      "reply_evidence": true,
      "ticket_channel_is_email": true,
      "email_channel_send_message_used": true,
      "email_channel_operator_reply": true,
      "email_channel_outbound_endpoint_used": true,
      "outbound_message_count_delta_ge_1": true,
      "outbound_last_message_source_middleware": false,
      "outbound_attempted": true,
      "routed_to_support": true,
      "support_tag_present": true,
      "support_department": true,
      "order_match_success": true,
      "order_match_by_number": null,
      "order_match_failure_reason_present": null,
      "openai_routing_called": true,
      "openai_routing_source_openai": true,
      "openai_rewrite_attempted": true,
      "openai_rewrite_applied": true,
      "allowlist_blocked_tag_present": false,
      "allowlist_blocked_tag_added": false,
      "send_message_tag_absent": false,
      "no_unexpected_outbound_block": null,
      "followup_performed": true,
      "followup_no_reply": true,
      "followup_routed_support": true,
      "followup_route_tag": true,
      "followup_skip_followup_tag": true,
      "operator_reply_present": true,
      "operator_reply_count_delta_ge_1": true,
      "send_message_tag_present": true,
      "send_message_tag_added": true,
      "send_message_used": true,
      "pii_safe": true
    },
    "criteria_details": [
      {
        "name": "webhook_accepted",
        "description": "Webhook /webhook returned status=accepted",
        "required": true,
        "value": true
      },
      {
        "name": "dynamo_records",
        "description": "Idempotency, state, and audit records were written",
        "required": true,
        "value": true
      },
      {
        "name": "ticket_lookup",
        "description": "Richpanel ticket snapshot was fetched (pre/post)",
        "required": true,
        "value": true
      },
      {
        "name": "intent_order_status",
        "description": "Routing intent matched order-status keywords",
        "required": true,
        "value": true
      },
      {
        "name": "middleware_outcome",
        "description": "Ticket resolved/closed or success middleware tag added this run; fails if skip/escalation tags added",
        "required": true,
        "value": true
      },
      {
        "name": "status_resolved_or_closed",
        "description": "Post status is resolved/closed",
        "required": true,
        "value": true
      },
      {
        "name": "middleware_tag_applied",
        "description": "Success middleware tag (mw-auto-replied/mw-order-status-answered/mw-reply-sent) added this run",
        "required": false,
        "value": true
      },
      {
        "name": "order_match_by_number",
        "description": "Order match resolved by order number",
        "required": false,
        "value": null
      },
      {
        "name": "no_skip_tags",
        "description": "No skip/error tags added this run (mw-skip-*, route-*-support-team, mw-escalated-human)",
        "required": true,
        "value": true
      },
      {
        "name": "reply_evidence",
        "description": "Middleware reply evidence observed (message_count_delta>0 or last_message_source=middleware or positive middleware tag added)",
        "required": false,
        "value": true
      },
      {
        "name": "outbound_message_count_delta_ge_1",
        "description": "Outbound reply increased message count (message_count_delta>=1)",
        "required": true,
        "value": true
      },
      {
        "name": "outbound_last_message_source_middleware",
        "description": "Explicit last_message_source marked middleware",
        "required": false,
        "value": false
      },
      {
        "name": "operator_reply_present",
        "description": "Latest comment flagged is_operator=true (operator reply)",
        "required": true,
        "value": true
      },
      {
        "name": "send_message_tag_present",
        "description": "Ticket tagged with mw-outbound-path-send-message (send-message path)",
        "required": false,
        "value": true
      },
      {
        "name": "send_message_tag_added",
        "description": "mw-outbound-path-send-message tag added this run",
        "required": false,
        "value": true
      },
      {
        "name": "send_message_used",
        "description": "Outbound reply used /send-message (operator reply path)",
        "required": false,
        "value": true
      },
      {
        "name": "email_channel_send_message_used",
        "description": "Email-channel outbound used /send-message",
        "required": true,
        "value": true
      },
      {
        "name": "email_channel_outbound_endpoint_used",
        "description": "Outbound endpoint resolved to /send-message",
        "required": true,
        "value": true
      },
      {
        "name": "email_channel_operator_reply",
        "description": "Latest comment marked is_operator=true",
        "required": true,
        "value": true
      },
      {
        "name": "openai_routing_called",
        "description": "OpenAI routing was invoked for intent detection",
        "required": true,
        "value": true
      },
      {
        "name": "openai_routing_source_openai",
        "description": "OpenAI routing selected as the final routing source",
        "required": false,
        "value": true
      },
      {
        "name": "openai_rewrite_attempted",
        "description": "OpenAI rewrite was attempted for the draft reply",
        "required": true,
        "value": true
      },
      {
        "name": "openai_rewrite_applied",
        "description": "OpenAI rewrite applied or fallback recorded",
        "required": true,
        "value": true
      },
      {
        "name": "followup_performed",
        "description": "Follow-up webhook was sent when requested",
        "required": true,
        "value": true
      },
      {
        "name": "followup_no_reply",
        "description": "Follow-up produced no additional middleware reply",
        "required": true,
        "value": true
      },
      {
        "name": "followup_routed_support",
        "description": "Follow-up resulted in route-to-support outcome",
        "required": true,
        "value": true
      },
      {
        "name": "followup_route_tag",
        "description": "Follow-up applied route-email-support-team tag",
        "required": true,
        "value": true
      },
      {
        "name": "followup_skip_followup_tag",
        "description": "Follow-up applied mw-skip-followup-after-auto-reply tag",
        "required": true,
        "value": true
      },
      {
        "name": "pii_safe",
        "description": "Proof JSON passed PII guard scan",
        "required": true,
        "value": true
      }
    ],
    "failure_reason": null
  }
}