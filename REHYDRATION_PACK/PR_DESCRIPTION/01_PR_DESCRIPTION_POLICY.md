# PR Description Policy

This document defines **mandatory policies** for PR descriptions in RichPanel.

These policies exist to:

1. Make PR checks (Bugbot / Codecov / Claude) **more accurate**.
2. Make reviews **faster** by eliminating ambiguity.
3. Provide **auditability** (what was intended, what was proven).

---

## Policy scope

This policy governs:

- PR **title**
- PR **body/description**
- The placement and format of **evidence links/paths**

It does **not** govern:

- commit message format
- branch naming
- code style conventions

---

## Non-negotiable rules

### P0 — No placeholders without links
**Forbidden:** “CI will pass”, “Codecov pending”, “Bugbot pending” with no link.

**Allowed:**
- “CI: pending — <Actions run link>”
- “Codecov: pending — <Codecov link (or PR checks page link)>”
- “Bugbot: pending — will update — <PR link or Bugbot comment link once posted>”

Rationale: reviewers and tools need **pointers**. Even “pending” must be *anchored*.

### P1 — Required section set
Every PR must include these sections (in this order):

1. **Summary**
2. **Why**
3. **Expected behavior & invariants**
4. **What changed**
5. **Scope / files touched**
6. **Test plan**
7. **Results & evidence**
8. **Risk & rollback**
9. **Reviewer + tool focus**

Exception: **Docs-only / risk:R0** can use the “R0 compact template” in **02_PR_DESCRIPTION_TEMPLATE.md**, but must still include invariants + evidence.

### P2 — Every claim must be provable
If the PR description claims:

- “default off”
- “PII safe”
- “GET only”
- “no writes”
- “PASS_STRONG”

Then the PR must include **exact** evidence pointers:

- test command and output location
- artifact path(s)
- or CI link(s)

### P3 — Invariants must be explicit
Invariants are “must never regress” constraints.

A PR must list invariants as **bullet points** and they must be testable or auditable.

Examples:

- Default must be OFF (`OPENAI_LOG_RESPONSE_EXCERPT=false` by default).
- Never log raw request/response bodies.
- Production must fail-closed when safety flags are missing.
- Shadow mode must never issue POST/PUT/PATCH/DELETE.

### P4 — Risk label must match content
- The PR body must state **Risk: risk:R#** and explain why.
- If the PR touches runtime behavior, security, prod gates, or automation logic, it cannot be labeled as docs-only.

### P5 — PR body must stand alone
The PR must be understandable **without** reading:

- Cursor summary block
- commit history
- external chat logs

Cursor’s autogenerated `<!-- CURSOR_SUMMARY -->` section is welcome, but it is **not** a substitute.

---

## Formatting requirements

### Use plain ASCII for checkmarks
Avoid encoding artifacts.

Preferred:

- `- [x] item`
- `- [ ] item`
- `✅ item` (ASCII-friendly in most environments, but use with caution)

Avoid:

- “âœ…” sequences and other mojibake.

### Use stable, grep-friendly keys
The following keys should appear exactly in the PR body to enable tooling:

- `Run ID:`
- `Risk:`
- `CI:`
- `Codecov:`
- `Bugbot:`
- `Claude gate:`

### Keep evidence paths copy-pastable
Evidence paths must be inside backticks and be valid repo paths.

Example:

- `REHYDRATION_PACK/RUNS/RUN_20260120_0221Z/B/RUN_REPORT.md`

---

## Content requirements (what must be present)

### Summary
- 1–3 bullets
- Each bullet must be outcome-based (“Adds X”, “Prevents Y”), not process-based (“Refactored”).

### Why
- state the production/user risk
- describe the pre-change failure mode
- explain why this solution is safest

### Expected behavior & invariants
Must include:

- Invariants (must never regress)
- Non-goals (explicitly: what this PR does *not* change)

### What changed
- link each change to a file area
- include decision points (why you chose A vs B)

### Scope / files touched
- list main files only (not every generated artifact)
- categorize: runtime code vs tests vs docs vs CI

### Test plan
- exact commands
- environment assumptions (local/dev/staging)
- include negative tests if relevant

### Results & evidence
Must include:

- CI link
- Codecov link
- Bugbot status link (or “pending link will appear after @cursor review comment”) **with the PR comment URL once present**
- any run artifacts, proof JSONs, logs

### Risk & rollback
Must include:

- risk label
- what could go wrong
- rollback steps
- any cleanup actions (artifact removal, secrets reset)

### Reviewer + tool focus
- 2–5 bullets
- include “Please ignore” bullets to reduce noise

---

## Risk-aware requirements

### risk:R0 (docs only)
Must include:

- what docs change
- why
- evidence: doc registry regen, doc hygiene check
- explicit invariant: “No runtime code changes”

### risk:R1–R2 (low/medium)
Add:

- edge cases
- test coverage expectations
- mention which files are most important to review

### risk:R3–R4 (high)
Add:

- threat model / safety constraints
- rollout plan (even if “none; revert only”)
- monitoring/validation signals
- explicit “what would constitute a bad outcome”

---

## Anti-patterns (must not do)

- Copying the Cursor summary and calling it a PR body.
- Saying “safe” without listing *why* it is safe.
- Omitting invariants because “it’s obvious”.
- Listing 50+ files without categorizing.
- Claiming tests were run without commands.

